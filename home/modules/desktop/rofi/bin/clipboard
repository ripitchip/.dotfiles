#!/bin/sh

MAX_PREVIEW=80

selection=$(cliphist list | while IFS=$'\t' read -r id preview; do
    lines=$(cliphist decode "$id" | wc -l)
    lines=$((lines + 1))

    clean_preview=$(printf "%s" "$preview" \
        | tr '\n' 'â†©' \
        | sed 's/[[:space:]]\+/ /g' \
        | cut -c1-"$MAX_PREVIEW")

    printf "%d\t%s\t%s\n" "$lines" "$clean_preview" "$id"
done | rofi -theme ~/.config/rofi/themes/clipboard.rasi -dmenu -sync | awk -F'\t' '{print $3}')

# Only decode and copy if selection is non-empty
if [ -n "$selection" ]; then
    cliphist decode "$selection" | wl-copy
fi